<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI方言文化守护者</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  
  <!-- 配置Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#9E2A2B',      // 传统红色
            secondary: '#E6B89C',    // 暖金色
            accent: '#540B0E',       // 深红色
            light: '#FFF8F0',        // 米白色
            dark: '#493323',         // 深棕色
          },
          fontFamily: {
            sans: ['Noto Sans SC', 'sans-serif'],
            serif: ['Noto Serif SC', 'serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .text-shadow {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }
      .village-shadow {
        filter: drop-shadow(0 10px 8px rgb(0 0 0 / 0.2));
      }
      .animate-float {
        animation: float 3s ease-in-out infinite;
      }
      .animate-pulse-slow {
        animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .backdrop-blur {
        backdrop-filter: blur(8px);
      }
    }
    
    @keyframes float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }
  </style>
</head>

<body class="bg-light min-h-screen font-sans text-dark overflow-x-hidden">
  <!-- 顶部导航 -->
  <header class="fixed top-0 left-0 right-0 z-50 transition-all duration-300" id="mainHeader">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center bg-primary/90 backdrop-blur text-light">
      <div class="flex items-center space-x-2">
        <i class="fa fa-microphone text-2xl text-secondary animate-pulse-slow"></i>
        <h1 class="text-xl md:text-2xl font-serif font-bold">方言文化守护者</h1>
      </div>
      
      <div class="flex items-center space-x-6">
        <button class="hidden md:flex items-center space-x-1 hover:text-secondary transition-colors" id="rankBtn">
          <i class="fa fa-trophy"></i>
          <span>排行榜</span>
        </button>
        <button class="hidden md:flex items-center space-x-1 hover:text-secondary transition-colors" id="mapBtn">
          <i class="fa fa-map"></i>
          <span>方言地图</span>
        </button>
        <div class="relative">
          <button class="w-10 h-10 rounded-full bg-secondary flex items-center justify-center text-accent hover:scale-110 transition-transform" id="userBtn">
            <i class="fa fa-user"></i>
          </button>
        </div>
        <button class="md:hidden text-xl" id="mobileMenuBtn">
          <i class="fa fa-bars"></i>
        </button>
      </div>
    </div>
    
    <!-- 移动端菜单 -->
    <div class="md:hidden bg-primary/95 backdrop-blur text-light hidden" id="mobileMenu">
      <div class="container mx-auto px-4 py-3 flex flex-col space-y-4">
        <button class="flex items-center space-x-2 py-2 border-b border-secondary/30" id="mobileRankBtn">
          <i class="fa fa-trophy w-6"></i>
          <span>排行榜</span>
        </button>
        <button class="flex items-center space-x-2 py-2 border-b border-secondary/30" id="mobileMapBtn">
          <i class="fa fa-map w-6"></i>
          <span>方言地图</span>
        </button>
        <button class="flex items-center space-x-2 py-2" id="mobileHelpBtn">
          <i class="fa fa-question-circle w-6"></i>
          <span>游戏帮助</span>
        </button>
      </div>
    </div>
  </header>

  <!-- 主游戏区域 -->
  <main class="pt-16 min-h-screen flex flex-col">
    <!-- 游戏介绍弹窗 -->
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-dark/70 backdrop-blur" id="introModal">
      <div class="bg-light rounded-xl p-6 md:p-8 max-w-md w-full mx-4 shadow-2xl transform transition-all">
        <h2 class="text-2xl font-serif font-bold text-primary mb-4 text-center">欢迎来到方言村落</h2>
        <p class="mb-4 text-dark/80">在这个虚拟村落中，你将成为方言文化守护者，通过采集方言发音和解答文化谜题，修复古老的村落建筑，传承珍贵的方言文化。</p>
        <div class="grid grid-cols-2 gap-4 mb-6">
          <div class="bg-light border border-secondary rounded-lg p-3 flex flex-col items-center">
            <i class="fa fa-microphone text-primary text-xl mb-2"></i>
            <span class="text-sm text-center">方言采集</span>
          </div>
          <div class="bg-light border border-secondary rounded-lg p-3 flex flex-col items-center">
            <i class="fa fa-puzzle-piece text-primary text-xl mb-2"></i>
            <span class="text-sm text-center">文化解谜</span>
          </div>
        </div>
        <button class="w-full bg-primary hover:bg-accent text-light py-3 rounded-lg transition-colors font-medium" id="startBtn">
          开始守护之旅
        </button>
      </div>
    </div>

    <!-- 村落主场景 -->
    <section id="villageScene" class="flex-1 container mx-auto px-4 py-6">
      <!-- 进度条 -->
      <div class="mb-6 bg-light border border-secondary/30 rounded-full h-3 overflow-hidden">
        <div id="restorationProgress" class="bg-primary h-full w-0 transition-all duration-1000" style="width: 15%"></div>
      </div>
      <div class="flex justify-between text-sm mb-2">
        <span>村落修复进度：15%</span>
        <span id="collectedCount">已收集方言：5/50</span>
      </div>
      
      <!-- 虚拟村落 -->
      <div class="relative bg-gradient-to-b from-blue-50 to-green-50 rounded-2xl overflow-hidden village-shadow mb-8 h-[500px] md:h-[600px]">
        <!-- 背景元素 -->
        <div class="absolute inset-0 bg-[url('https://picsum.photos/id/1018/1200/800')] bg-cover bg-center opacity-20"></div>
        
        <!-- 天空和太阳 -->
        <div class="absolute top-6 right-6 w-16 h-16 bg-yellow-400 rounded-full opacity-80 animate-pulse-slow"></div>
        
        <!-- 村落建筑 - 部分修复状态 -->
        <div class="absolute bottom-0 left-0 right-0 h-3/5 flex justify-around items-end px-4">
          <!-- 已修复建筑 -->
          <div class="village-building w-20 md:w-28 animate-float" data-building="teahouse">
            <img src="https://picsum.photos/id/1048/200/300" alt="茶馆" class="w-full h-auto rounded-t-lg shadow-lg">
            <div class="bg-secondary/80 text-dark text-xs text-center py-1 rounded-b-lg">茶馆</div>
          </div>
          
          <!-- 待修复建筑 - 模糊状态 -->
          <div class="village-building w-20 md:w-28 opacity-50 filter grayscale" data-building="temple">
            <img src="https://picsum.photos/id/1053/200/300" alt="祠堂" class="w-full h-auto rounded-t-lg shadow-lg">
            <div class="bg-gray-400/80 text-dark text-xs text-center py-1 rounded-b-lg">祠堂</div>
          </div>
          
          <div class="village-building w-20 md:w-28 opacity-50 filter grayscale" data-building="school">
            <img src="https://picsum.photos/id/1071/200/300" alt="学堂" class="w-full h-auto rounded-t-lg shadow-lg">
            <div class="bg-gray-400/80 text-dark text-xs text-center py-1 rounded-b-lg">学堂</div>
          </div>
          
          <div class="village-building w-20 md:w-28 opacity-50 filter grayscale" data-building="market">
            <img src="https://picsum.photos/id/133/200/300" alt="市集" class="w-full h-auto rounded-t-lg shadow-lg">
            <div class="bg-gray-400/80 text-dark text-xs text-center py-1 rounded-b-lg">市集</div>
          </div>
        </div>
        
        <!-- 虚拟村民 - 可交互NPC -->
        <div class="absolute bottom-40 left-[20%] w-12 h-12 md:w-16 md:h-16 cursor-pointer hover:scale-110 transition-transform animate-float" id="villager1" data-dialect="cantonese">
          <img src="https://picsum.photos/id/64/100/100" alt="粤语村民" class="w-full h-full rounded-full border-2 border-secondary">
          <div class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 bg-secondary text-dark text-xs px-2 py-1 rounded whitespace-nowrap">李阿婆 (粤语)</div>
        </div>
        
        <div class="absolute bottom-48 right-[30%] w-12 h-12 md:w-16 md:h-16 cursor-pointer hover:scale-110 transition-transform animate-float" style="animation-delay: 0.5s" id="villager2" data-dialect="sichuan">
          <img src="https://picsum.photos/id/91/100/100" alt="四川话村民" class="w-full h-full rounded-full border-2 border-secondary">
          <div class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 bg-secondary text-dark text-xs px-2 py-1 rounded whitespace-nowrap">张大爷 (四川话)</div>
        </div>
        
        <!-- 任务标记 -->
        <div class="absolute top-1/4 left-[35%] bg-primary text-light text-xs px-3 py-1 rounded-full flex items-center space-x-1 cursor-pointer hover:bg-accent transition-colors" id="puzzleMarker">
          <i class="fa fa-puzzle-piece"></i>
          <span>文化谜题</span>
        </div>
      </div>
      
      <!-- 功能按钮区 -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <button class="bg-primary hover:bg-accent text-light py-3 rounded-lg transition-all flex flex-col items-center justify-center shadow-md hover:shadow-lg transform hover:-translate-y-1" id="collectBtn">
          <i class="fa fa-microphone text-xl mb-2"></i>
          <span>方言采集</span>
        </button>
        <button class="bg-secondary hover:bg-secondary/80 text-dark py-3 rounded-lg transition-all flex flex-col items-center justify-center shadow-md hover:shadow-lg transform hover:-translate-y-1" id="puzzleBtn">
          <i class="fa fa-puzzle-piece text-xl mb-2"></i>
          <span>文化解谜</span>
        </button>
        <button class="bg-light border border-primary text-primary hover:bg-primary/10 py-3 rounded-lg transition-all flex flex-col items-center justify-center shadow-md hover:shadow-lg transform hover:-translate-y-1" id="collectionBtn">
          <i class="fa fa-book text-xl mb-2"></i>
          <span>方言收藏</span>
        </button>
        <button class="bg-light border border-primary text-primary hover:bg-primary/10 py-3 rounded-lg transition-all flex flex-col items-center justify-center shadow-md hover:shadow-lg transform hover:-translate-y-1" id="achievementBtn">
          <i class="fa fa-medal text-xl mb-2"></i>
          <span>成就徽章</span>
        </button>
      </div>
    </section>
    
    <!-- 方言采集界面 -->
    <section id="collectScene" class="flex-1 container mx-auto px-4 py-6 hidden">
      <button class="mb-6 flex items-center text-primary hover:text-accent transition-colors" id="backToVillage">
        <i class="fa fa-arrow-left mr-2"></i>
        <span>返回村落</span>
      </button>
      
      <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
        <!-- 村民对话区 -->
        <div class="bg-primary text-light p-6">
          <div class="flex items-start space-x-4">
            <img src="https://picsum.photos/id/64/100/100" alt="李阿婆" class="w-14 h-14 rounded-full border-2 border-secondary" id="currentVillagerImg">
            <div>
              <h3 class="text-xl font-medium" id="currentVillagerName">李阿婆 (粤语)</h3>
              <p class="mt-2 bg-light/10 p-4 rounded-lg inline-block max-w-lg" id="villagerDialogue">后生仔，你想知乜嘢啊？我可以教你几句地道嘅广东话。</p>
            </div>
          </div>
        </div>
        
        <!-- 采集内容区 -->
        <div class="p-6">
          <h3 class="text-lg font-medium mb-4">请跟着念：<span class="text-primary font-bold" id="targetPhrase">食饭（吃饭）</span></h3>
          
          <div class="flex flex-col items-center justify-center py-8 border-2 border-dashed border-secondary/50 rounded-xl mb-6">
            <button id="recordBtn" class="w-20 h-20 rounded-full bg-primary text-light flex items-center justify-center text-3xl hover:bg-accent transition-all shadow-lg hover:scale-105 mb-4">
              <i class="fa fa-microphone"></i>
            </button>
            <p class="text-sm text-dark/60" id="recordStatus">点击麦克风开始录音</p>
            
            <!-- 波形动画 (录音时显示) -->
            <div class="flex items-center justify-center space-x-1 mt-6 hidden" id="waveform">
              <div class="w-1 h-3 bg-primary rounded-full animate-pulse"></div>
              <div class="w-1 h-6 bg-primary rounded-full animate-pulse" style="animation-delay: 0.1s"></div>
              <div class="w-1 h-8 bg-primary rounded-full animate-pulse" style="animation-delay: 0.2s"></div>
              <div class="w-1 h-5 bg-primary rounded-full animate-pulse" style="animation-delay: 0.3s"></div>
              <div class="w-1 h-7 bg-primary rounded-full animate-pulse" style="animation-delay: 0.4s"></div>
              <div class="w-1 h-4 bg-primary rounded-full animate-pulse" style="animation-delay: 0.5s"></div>
              <div class="w-1 h-6 bg-primary rounded-full animate-pulse" style="animation-delay: 0.6s"></div>
            </div>
          </div>
          
          <!-- 识别结果 -->
          <div class="mb-6 hidden" id="resultContainer">
            <h4 class="font-medium mb-2">识别结果：</h4>
            <div class="bg-light border border-secondary/30 p-4 rounded-lg">
              <div class="flex justify-between mb-2">
                <span>方言发音：</span>
                <span class="font-medium" id="dialectResult">食饭</span>
              </div>
              <div class="flex justify-between mb-2">
                <span>普通话对照：</span>
                <span class="font-medium">吃饭</span>
              </div>
              <div class="flex justify-between">
                <span>匹配度：</span>
                <span class="font-medium text-primary" id="matchScore">85%</span>
              </div>
            </div>
          </div>
          
          <!-- 操作按钮 -->
          <div class="flex justify-between">
            <button class="px-6 py-2 border border-primary text-primary rounded-lg hover:bg-primary/10 transition-colors" id="skipBtn">
              跳过这句
            </button>
            <button class="px-6 py-2 bg-primary text-light rounded-lg hover:bg-accent transition-colors" id="nextPhraseBtn" disabled>
              下一句
            </button>
          </div>
        </div>
      </div>
    </section>
    
    <!-- 文化解谜界面 -->
    <section id="puzzleScene" class="flex-1 container mx-auto px-4 py-6 hidden">
      <button class="mb-6 flex items-center text-primary hover:text-accent transition-colors" id="backFromPuzzle">
        <i class="fa fa-arrow-left mr-2"></i>
        <span>返回村落</span>
      </button>
      
      <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
        <div class="p-6 border-b border-gray-100">
          <h2 class="text-2xl font-serif font-bold text-primary">粤语文化谜题：饮茶</h2>
          <p class="mt-2 text-dark/70">请根据提示，选择正确的广东早茶点心组合</p>
        </div>
        
        <div class="p-6">
          <!-- 谜题说明 -->
          <div class="bg-light border border-secondary/30 p-4 rounded-lg mb-6">
            <p class="mb-2"><span class="font-medium">粤语词汇：</span>饮茶</p>
            <p class="mb-2"><span class="font-medium">普通话：</span>喝茶</p>
            <p><span class="font-medium">文化含义：</span>不仅是喝茶，更是广东人重要的社交方式，通常搭配各种精致点心。</p>
          </div>
          
          <!-- 谜题区域 -->
          <div class="mb-8">
            <h3 class="font-medium mb-4">请选择属于广东早茶的点心（可多选）：</h3>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="puzzleOptions">
              <div class="puzzle-option border border-gray-200 rounded-lg overflow-hidden cursor-pointer hover:border-primary transition-colors" data-correct="true">
                <img src="https://picsum.photos/id/292/300/200" alt="虾饺" class="w-full h-40 object-cover">
                <div class="p-2 text-center text-sm">虾饺</div>
              </div>
              <div class="puzzle-option border border-gray-200 rounded-lg overflow-hidden cursor-pointer hover:border-primary transition-colors" data-correct="true">
                <img src="https://picsum.photos/id/431/300/200" alt="烧卖" class="w-full h-40 object-cover">
                <div class="p-2 text-center text-sm">烧卖</div>
              </div>
              <div class="puzzle-option border border-gray-200 rounded-lg overflow-hidden cursor-pointer hover:border-primary transition-colors" data-correct="false">
                <img src="https://picsum.photos/id/225/300/200" alt="饺子" class="w-full h-40 object-cover">
                <div class="p-2 text-center text-sm">饺子</div>
              </div>
              <div class="puzzle-option border border-gray-200 rounded-lg overflow-hidden cursor-pointer hover:border-primary transition-colors" data-correct="true">
                <img src="https://picsum.photos/id/312/300/200" alt="肠粉" class="w-full h-40 object-cover">
                <div class="p-2 text-center text-sm">肠粉</div>
              </div>
              <div class="puzzle-option border border-gray-200 rounded-lg overflow-hidden cursor-pointer hover:border-primary transition-colors" data-correct="false">
                <img src="https://picsum.photos/id/488/300/200" alt="包子" class="w-full h-40 object-cover">
                <div class="p-2 text-center text-sm">包子</div>
              </div>
              <div class="puzzle-option border border-gray-200 rounded-lg overflow-hidden cursor-pointer hover:border-primary transition-colors" data-correct="true">
                <img src="https://picsum.photos/id/493/300/200" alt="叉烧包" class="w-full h-40 object-cover">
                <div class="p-2 text-center text-sm">叉烧包</div>
              </div>
              <div class="puzzle-option border border-gray-200 rounded-lg overflow-hidden cursor-pointer hover:border-primary transition-colors" data-correct="false">
                <img src="https://picsum.photos/id/537/300/200" alt="粽子" class="w-full h-40 object-cover">
                <div class="p-2 text-center text-sm">粽子</div>
              </div>
              <div class="puzzle-option border border-gray-200 rounded-lg overflow-hidden cursor-pointer hover:border-primary transition-colors" data-correct="true">
                <img src="https://picsum.photos/id/365/300/200" alt="蛋挞" class="w-full h-40 object-cover">
                <div class="p-2 text-center text-sm">蛋挞</div>
              </div>
            </div>
          </div>
          
          <!-- 提交按钮 -->
          <button class="w-full py-3 bg-primary text-light rounded-lg hover:bg-accent transition-colors" id="submitPuzzle">
            提交答案
          </button>
        </div>
      </div>
    </section>
    
    <!-- 排行榜界面 -->
    <section id="rankScene" class="flex-1 container mx-auto px-4 py-6 hidden">
      <button class="mb-6 flex items-center text-primary hover:text-accent transition-colors" id="backFromRank">
        <i class="fa fa-arrow-left mr-2"></i>
        <span>返回村落</span>
      </button>
      
      <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
        <div class="p-6 border-b border-gray-100">
          <h2 class="text-2xl font-serif font-bold text-primary">方言守护者排行榜</h2>
          <p class="mt-1 text-dark/70">看看谁收集的方言最多，解开的谜题最棒！</p>
        </div>
        
        <div class="p-6">
          <!-- 排行榜标签 -->
          <div class="flex border-b border-gray-200 mb-6">
            <button class="px-4 py-2 font-medium text-primary border-b-2 border-primary" id="localRankTab">本地排行</button>
            <button class="px-4 py-2 font-medium text-dark/60 hover:text-primary" id="globalRankTab">全国排行</button>
          </div>
          
          <!-- 排行榜列表 -->
          <div class="space-y-4" id="rankList">
            <!-- 前三名特殊样式 -->
            <div class="flex items-center p-4 bg-yellow-50 rounded-lg border border-yellow-200">
              <div class="w-8 h-8 bg-yellow-400 text-dark rounded-full flex items-center justify-center font-bold mr-4">1</div>
              <img src="https://picsum.photos/id/64/100/100" alt="玩家头像" class="w-10 h-10 rounded-full mr-4">
              <div class="flex-1">
                <div class="font-medium">陈小华</div>
                <div class="text-sm text-dark/60">收集了42种方言</div>
              </div>
              <div class="text-right">
                <div class="font-bold text-primary">985分</div>
                <div class="text-xs text-dark/60">粤语大师</div>
              </div>
            </div>
            
            <div class="flex items-center p-4 bg-gray-50 rounded-lg border border-gray-200">
              <div class="w-8 h-8 bg-gray-300 text-dark rounded-full flex items-center justify-center font-bold mr-4">2</div>
              <img src="https://picsum.photos/id/91/100/100" alt="玩家头像" class="w-10 h-10 rounded-full mr-4">
              <div class="flex-1">
                <div class="font-medium">李大勇</div>
                <div class="text-sm text-dark/60">收集了38种方言</div>
              </div>
              <div class="text-right">
                <div class="font-bold text-primary">920分</div>
                <div class="text-xs text-dark/60">川话达人</div>
              </div>
            </div>
            
            <div class="flex items-center p-4 bg-amber-50 rounded-lg border border-amber-200">
              <div class="w-8 h-8 bg-amber-600 text-light rounded-full flex items-center justify-center font-bold mr-4">3</div>
              <img src="https://picsum.photos/id/22/100/100" alt="玩家头像" class="w-10 h-10 rounded-full mr-4">
              <div class="flex-1">
                <div class="font-medium">王小花</div>
                <div class="text-sm text-dark/60">收集了35种方言</div>
              </div>
              <div class="text-right">
                <div class="font-bold text-primary">875分</div>
                <div class="text-xs text-dark/60">吴语能手</div>
              </div>
            </div>
            
            <!-- 其他排名 -->
            <div class="flex items-center p-4 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="w-8 h-8 bg-gray-200 text-dark rounded-full flex items-center justify-center font-bold mr-4">4</div>
              <img src="https://picsum.photos/id/29/100/100" alt="玩家头像" class="w-10 h-10 rounded-full mr-4">
              <div class="flex-1">
                <div class="font-medium">赵小明</div>
                <div class="text-sm text-dark/60">收集了30种方言</div>
              </div>
              <div class="text-right">
                <div class="font-bold text-primary">820分</div>
                <div class="text-xs text-dark/60">闽语新秀</div>
              </div>
            </div>
            
            <div class="flex items-center p-4 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="w-8 h-8 bg-gray-200 text-dark rounded-full flex items-center justify-center font-bold mr-4">5</div>
              <img src="https://picsum.photos/id/33/100/100" alt="玩家头像" class="w-10 h-10 rounded-full mr-4">
              <div class="flex-1">
                <div class="font-medium">我</div>
                <div class="text-sm text-dark/60">收集了5种方言</div>
              </div>
              <div class="text-right">
                <div class="font-bold text-primary">150分</div>
                <div class="text-xs text-dark/60">初学者</div>
              </div>
            </div>
          </div>
          
          <!-- 我的成就 -->
          <div class="mt-8 p-4 bg-light rounded-lg border border-secondary/30">
            <h3 class="font-medium mb-3">我的成就</h3>
            <div class="grid grid-cols-3 gap-2">
              <div class="bg-white rounded p-3 text-center text-sm">
                <div class="text-primary font-bold mb-1">5</div>
                <div>方言收集</div>
              </div>
              <div class="bg-white rounded p-3 text-center text-sm">
                <div class="text-primary font-bold mb-1">2</div>
                <div>谜题解开</div>
              </div>
              <div class="bg-white rounded p-3 text-center text-sm">
                <div class="text-primary font-bold mb-1">1</div>
                <div>建筑修复</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- 成功提示弹窗 -->
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-dark/50 backdrop-blur hidden" id="successModal">
      <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-2xl transform transition-all scale-95 opacity-0" id="modalContent">
        <div class="text-center">
          <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fa fa-check text-2xl text-primary"></i>
          </div>
          <h3 class="text-xl font-bold text-primary mb-2" id="modalTitle">采集成功！</h3>
          <p class="text-dark/70 mb-6" id="modalMessage">你成功收集了"食饭"这个粤语词汇，村落修复进度+5%</p>
          
          <!-- 建筑修复动画 -->
          <div class="mb-6 h-32 overflow-hidden rounded-lg hidden" id="buildingAnimation">
            <img src="https://picsum.photos/id/1053/400/200" alt="祠堂修复" class="w-full h-full object-cover grayscale" id="repairingImage">
          </div>
          
          <button class="w-full bg-primary hover:bg-accent text-light py-3 rounded-lg transition-colors font-medium" id="modalConfirmBtn">
            继续探索
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="bg-dark text-light py-6">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <div class="flex items-center space-x-2 justify-center md:justify-start">
            <i class="fa fa-microphone text-secondary"></i>
            <span class="font-serif font-bold">方言文化守护者</span>
          </div>
          <p class="text-sm text-light/60 mt-2 text-center md:text-left">传承方言文化，连接地域情感</p>
        </div>
        
        <div class="flex space-x-6">
          <a href="#" class="text-light/80 hover:text-secondary transition-colors">
            <i class="fa fa-question-circle"></i>
            <span class="ml-1">帮助中心</span>
          </a>
          <a href="#" class="text-light/80 hover:text-secondary transition-colors">
            <i class="fa fa-info-circle"></i>
            <span class="ml-1">关于我们</span>
          </a>
          <a href="#" class="text-light/80 hover:text-secondary transition-colors">
            <i class="fa fa-share-alt"></i>
            <span class="ml-1">分享</span>
          </a>
        </div>
      </div>
      
      <div class="mt-6 pt-6 border-t border-light/10 text-center text-sm text-light/40">
        © 2023 方言文化守护者 - 保护方言，传承文化
      </div>
    </div>
  </footer>

  <script>
    // 页面元素引用
    const introModal = document.getElementById('introModal');
    const startBtn = document.getElementById('startBtn');
    const villageScene = document.getElementById('villageScene');
    const collectScene = document.getElementById('collectScene');
    const puzzleScene = document.getElementById('puzzleScene');
    const rankScene = document.getElementById('rankScene');
    const backToVillage = document.getElementById('backToVillage');
    const backFromPuzzle = document.getElementById('backFromPuzzle');
    const backFromRank = document.getElementById('backFromRank');
    const collectBtn = document.getElementById('collectBtn');
    const puzzleBtn = document.getElementById('puzzleBtn');
    const puzzleMarker = document.getElementById('puzzleMarker');
    const villagers = [document.getElementById('villager1'), document.getElementById('villager2')];
    const rankBtn = document.getElementById('rankBtn');
    const mobileRankBtn = document.getElementById('mobileRankBtn');
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    const currentVillagerImg = document.getElementById('currentVillagerImg');
    const currentVillagerName = document.getElementById('currentVillagerName');
    const villagerDialogue = document.getElementById('villagerDialogue');
    const targetPhrase = document.getElementById('targetPhrase');
    const recordBtn = document.getElementById('recordBtn');
    const recordStatus = document.getElementById('recordStatus');
    const waveform = document.getElementById('waveform');
    const resultContainer = document.getElementById('resultContainer');
    const dialectResult = document.getElementById('dialectResult');
    const matchScore = document.getElementById('matchScore');
    const nextPhraseBtn = document.getElementById('nextPhraseBtn');
    const skipBtn = document.getElementById('skipBtn');
    const puzzleOptions = document.querySelectorAll('.puzzle-option');
    const submitPuzzle = document.getElementById('submitPuzzle');
    const successModal = document.getElementById('successModal');
    const modalContent = document.getElementById('modalContent');
    const modalTitle = document.getElementById('modalTitle');
    const modalMessage = document.getElementById('modalMessage');
    const buildingAnimation = document.getElementById('buildingAnimation');
    const repairingImage = document.getElementById('repairingImage');
    const modalConfirmBtn = document.getElementById('modalConfirmBtn');
    const restorationProgress = document.getElementById('restorationProgress');
    const collectedCount = document.getElementById('collectedCount');
    const mainHeader = document.getElementById('mainHeader');
    
    // 游戏数据
    let gameData = {
      collectedPhrases: 5,
      totalPhrases: 50,
      restorationPercentage: 15,
      currentDialect: 'cantonese',
      currentPhraseIndex: 0,
      selectedPuzzleOptions: [],
      phrases: {
        cantonese: [
          { dialect: '食饭', mandarin: '吃饭', dialogue: '后生仔，"食饭"系广东话吃饭嘅意思，你嚟试下讲啦。' },
          { dialect: '饮茶', mandarin: '喝茶', dialogue: '我哋广东人钟意"饮茶"，其实唔单止系饮啲茶，仲有好多点心架。' },
          { dialect: '后生仔', mandarin: '年轻人', dialogue: '"后生仔"就系指你哋呢啲年轻人啦，有活力！' },
          { dialect: '早晨', mandarin: '早上好', dialogue: '朝早见到人，我哋会讲"早晨"，就系早上好嘅意思啦。' }
        ],
        sichuan: [
          { dialect: '吃饭', mandarin: '吃饭', dialogue: '四川话里说"吃饭"，跟普通话有点像，但音调不一样哦。' },
          { dialect: '摆龙门阵', mandarin: '聊天', dialogue: '我们四川人喜欢"摆龙门阵"，就是大家一起聊天的意思。' },
          { dialect: '巴适', mandarin: '舒适', dialogue: '如果觉得很舒服，我们就会说"巴适得板"，你学会了吗？' },
          { dialect: '要得', mandarin: '好的', dialogue: '"要得"就是好的意思，答应别人的时候就可以这么说。' }
        ]
      }
    };
    
    // 初始化页面
    document.addEventListener('DOMContentLoaded', () => {
      // 为导航栏添加滚动效果
      window.addEventListener('scroll', () => {
        if (window.scrollY > 20) {
          mainHeader.classList.add('py-2', 'shadow-md');
          mainHeader.classList.remove('py-3');
        } else {
          mainHeader.classList.add('py-3');
          mainHeader.classList.remove('py-2', 'shadow-md');
        }
      });
      
      // 移动端菜单切换
      mobileMenuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });

      // 检查浏览器是否支持语音识别
      checkSpeechSupport();
    });
    
    // 检查浏览器语音识别支持
    function checkSpeechSupport() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert('您的浏览器不支持语音识别功能，请使用Chrome浏览器以获得最佳体验');
        // 禁用录音按钮
        recordBtn.disabled = true;
        recordBtn.classList.add('opacity-50', 'cursor-not-allowed');
        recordStatus.textContent = '您的浏览器不支持语音识别';
      }
    }
    
    // 开始游戏
    startBtn.addEventListener('click', () => {
      introModal.classList.add('opacity-0');
      setTimeout(() => {
        introModal.classList.add('hidden');
      }, 300);
    });
    
    // 场景切换函数
    function showScene(scene) {
      villageScene.classList.add('hidden');
      collectScene.classList.add('hidden');
      puzzleScene.classList.add('hidden');
      rankScene.classList.add('hidden');
      
      scene.classList.remove('hidden');
    }
    
    // 返回村落
    backToVillage.addEventListener('click', () => showScene(villageScene));
    backFromPuzzle.addEventListener('click', () => showScene(villageScene));
    backFromRank.addEventListener('click', () => showScene(villageScene));
    
    // 打开排行榜
    rankBtn.addEventListener('click', () => showScene(rankScene));
    mobileRankBtn.addEventListener('click', () => {
      mobileMenu.classList.add('hidden');
      showScene(rankScene);
    });
    
    // 打开谜题界面
    puzzleBtn.addEventListener('click', () => showScene(puzzleScene));
    puzzleMarker.addEventListener('click', () => showScene(puzzleScene));
    
    // 从村民进入采集界面
    villagers.forEach(villager => {
      villager.addEventListener('click', () => {
        const dialect = villager.getAttribute('data-dialect');
        enterCollectScene(dialect, villager.querySelector('img').src, villager.querySelector('div').textContent);
      });
    });
    
    // 从按钮进入采集界面（默认粤语）
    collectBtn.addEventListener('click', () => {
      enterCollectScene('cantonese', 'https://picsum.photos/id/64/100/100', '李阿婆 (粤语)');
    });
    
    // 进入采集界面
    function enterCollectScene(dialect, imgSrc, name) {
      gameData.currentDialect = dialect;
      gameData.currentPhraseIndex = 0;
      
      currentVillagerImg.src = imgSrc;
      currentVillagerName.textContent = name;
      
      // 重置录音状态
      recordStatus.textContent = '点击麦克风开始录音';
      waveform.classList.add('hidden');
      resultContainer.classList.add('hidden');
      nextPhraseBtn.disabled = true;
      
      // 加载第一个短语
      loadPhrase();
      
      showScene(collectScene);
    }
    
    // 加载短语
    function loadPhrase() {
      const phrases = gameData.phrases[gameData.currentDialect];
      if (gameData.currentPhraseIndex < phrases.length) {
        const phrase = phrases[gameData.currentPhraseIndex];
        targetPhrase.textContent = `${phrase.dialect}（${phrase.mandarin}）`;
        villagerDialogue.textContent = phrase.dialogue;
      } else {
        // 所有短语收集完毕，返回村落
        showSuccessModal('恭喜！', `你已成功收集完所有${currentVillagerName.textContent.split(' ')[1]}短语，村落修复进度+10%`, true);
      }
    }
    
    // 语音识别功能实现
    recordBtn.addEventListener('click', () => {
      // 获取语音识别构造函数（兼容不同浏览器）
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert('您的浏览器不支持语音识别功能');
        return;
      }
      
      // 创建识别实例
      const recognition = new SpeechRecognition();
      
      // 配置识别参数
      recognition.lang = 'zh-CN'; // 设置为中文
      recognition.interimResults = false; // 不返回临时结果
      recognition.maxAlternatives = 1; // 只返回一个最可能的结果
      
      // 更新UI状态
      recordStatus.textContent = '正在录音...请对着麦克风说出短语';
      waveform.classList.remove('hidden');
      recordBtn.disabled = true;
      
      // 开始识别
      recognition.start();
      
      // 识别成功处理
      recognition.onresult = (event) => {
        // 获取识别结果
        const speechResult = event.results[0][0].transcript.trim();
        
        // 获取当前目标短语
        const phrases = gameData.phrases[gameData.currentDialect];
        const currentPhrase = phrases[gameData.currentPhraseIndex];
        
        // 计算匹配度（简单逻辑：包含方言或普通话关键词）
        const dialectWords = currentPhrase.dialect.split('');
        const mandarinWords = currentPhrase.mandarin.split('');
        const resultWords = speechResult.split('');
        
        // 计算匹配的字符数
        let matchCount = 0;
        resultWords.forEach(word => {
          if (dialectWords.includes(word) || mandarinWords.includes(word)) {
            matchCount++;
          }
        });
        
        // 计算匹配度百分比（至少50%才认为有效）
        const totalWords = Math.max(dialectWords.length, resultWords.length);
        let score = totalWords > 0 ? Math.round((matchCount / totalWords) * 100) : 0;
        score = Math.max(50, Math.min(95, score)); // 限制在50-95之间
        
        // 更新UI显示结果
        waveform.classList.add('hidden');
        resultContainer.classList.remove('hidden');
        dialectResult.textContent = speechResult;
        matchScore.textContent = `${score}%`;
        recordStatus.textContent = '点击麦克风重新录音';
        nextPhraseBtn.disabled = score < 60; // 60分以上才允许继续
        recordBtn.disabled = false;
      };
      
      // 识别错误处理
      recognition.onerror = (event) => {
        console.error('语音识别错误:', event.error);
        waveform.classList.add('hidden');
        recordStatus.textContent = `识别失败: ${getErrorText(event.error)}`;
        recordBtn.disabled = false;
      };
      
      // 识别结束处理
      recognition.onend = () => {
        if (recordStatus.textContent.includes('正在录音')) {
          recordStatus.textContent = '录音已结束，正在处理...';
        }
      };
    });
    
    // 语音识别错误信息转换
    function getErrorText(error) {
      const errors = {
        'not-allowed': '需要麦克风权限，请允许浏览器访问麦克风',
        'no-speech': '未检测到语音，请重试',
        'audio-capture': '无法访问麦克风，请检查设备',
        'network': '网络错误，请稍后重试',
        'not-available': '语音识别服务不可用'
      };
      return errors[error] || `错误: ${error}`;
    }
    
    // 下一句短语
    nextPhraseBtn.addEventListener('click', () => {
      gameData.currentPhraseIndex++;
      gameData.collectedPhrases++;
      gameData.restorationPercentage += 5;
      
      // 更新进度
      collectedCount.textContent = `已收集方言：${gameData.collectedPhrases}/${gameData.totalPhrases}`;
      restorationProgress.style.width = `${gameData.restorationPercentage}%`;
      
      // 显示成功提示
      const phrases = gameData.phrases[gameData.currentDialect];
      const currentPhrase = phrases[gameData.currentPhraseIndex - 1];
      showSuccessModal('采集成功！', `你成功收集了"${currentPhrase.dialect}"这个词汇，村落修复进度+5%`);
    });
    
    // 跳过短语
    skipBtn.addEventListener('click', () => {
      gameData.currentPhraseIndex++;
      loadPhrase();
      
      // 重置录音状态
      recordStatus.textContent = '点击麦克风开始录音';
      waveform.classList.add('hidden');
      resultContainer.classList.add('hidden');
      nextPhraseBtn.disabled = true;
    });
    
    // 谜题选项选择
    puzzleOptions.forEach(option => {
      option.addEventListener('click', () => {
        option.classList.toggle('border-primary');
        option.classList.toggle('bg-primary/5');
        
        const isSelected = option.classList.contains('border-primary');
        const optionIndex = Array.from(puzzleOptions).indexOf(option);
        
        if (isSelected && !gameData.selectedPuzzleOptions.includes(optionIndex)) {
          gameData.selectedPuzzleOptions.push(optionIndex);
        } else if (!isSelected && gameData.selectedPuzzleOptions.includes(optionIndex)) {
          gameData.selectedPuzzleOptions = gameData.selectedPuzzleOptions.filter(index => index !== optionIndex);
        }
      });
    });
    
    // 提交谜题答案
    submitPuzzle.addEventListener('click', () => {
      if (gameData.selectedPuzzleOptions.length === 0) {
        alert('请至少选择一个选项');
        return;
      }
      
      // 检查答案（正确选项索引：0,1,3,5,7）
      const correctOptions = [0,1,3,5,7];
      const isAllCorrect = gameData.selectedPuzzleOptions.every(index => correctOptions.includes(index)) && 
                          gameData.selectedPuzzleOptions.length === correctOptions.length;
      
      if (isAllCorrect) {
        gameData.restorationPercentage += 10;
        restorationProgress.style.width = `${gameData.restorationPercentage}%`;
        showSuccessModal('解谜成功！', '你正确识别了广东早茶的经典点心，祠堂修复完成！', true, 'temple');
      } else {
        showSuccessModal('答案有误', '有些点心不属于广东早茶哦，再试一次吧！', false);
      }
    });
    
    // 显示成功提示弹窗
    function showSuccessModal(title, message, isSuccess = true, building = null) {
      modalTitle.textContent = title;
      modalMessage.textContent = message;
      
      // 如果是建筑修复，显示修复动画
      if (building) {
        buildingAnimation.classList.remove('hidden');
        // 找到对应的建筑图片
        const buildingImg = document.querySelector(`[data-building="${building}"] img`).src;
        repairingImage.src = buildingImg;
        
        // 延迟显示修复动画
        setTimeout(() => {
          repairingImage.classList.remove('grayscale');
        }, 500);
      } else {
        buildingAnimation.classList.add('hidden');
      }
      
      // 显示弹窗并添加动画
      successModal.classList.remove('hidden');
      setTimeout(() => {
        modalContent.classList.remove('scale-95', 'opacity-0');
        modalContent.classList.add('scale-100', 'opacity-100', 'transition-all', 'duration-300');
      }, 10);
    }
    
    // 确认弹窗
    modalConfirmBtn.addEventListener('click', () => {
      // 隐藏弹窗
      modalContent.classList.remove('scale-100', 'opacity-100');
      modalContent.classList.add('scale-95', 'opacity-0', 'transition-all', 'duration-300');
      
      setTimeout(() => {
        successModal.classList.add('hidden');
        repairingImage.classList.add('grayscale');
        
        // 如果是修复了建筑，更新村落中对应建筑的状态
        const building = document.querySelector('[data-building="temple"]');
        if (building) {
          building.classList.remove('opacity-50', 'filter', 'grayscale');
        }
        
        // 加载下一个短语或返回村落
        if (modalTitle.textContent === '采集成功！') {
          loadPhrase();
        } else {
          showScene(villageScene);
        }
      }, 300);
    });

// 文档已创建完成
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?9b4c37e10f257b9257308505094e5890";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        
        // 显示欢迎消息
        function showMessage() {
            alert('欢迎探索2ms的世界！');
        }
  </script>
</body>
</html>